"""
TooBit API 异常处理模块
"""

from typing import Optional, Dict, Any


class TooBitException(Exception):
    """TooBit API 基础异常类"""
    
    def __init__(self, message: str, code: Optional[int] = None, response: Optional[Dict[str, Any]] = None):
        self.message = message
        self.code = code
        self.response = response or {}
        super().__init__(self.message)


class ConfigurationError(TooBitException):
    """配置错误"""
    pass


class AuthenticationError(TooBitException):
    """认证错误"""
    pass


class APIError(TooBitException):
    """API调用错误"""
    pass


class RateLimitError(TooBitException):
    """速率限制错误"""
    pass


class ValidationError(TooBitException):
    """参数验证错误"""
    pass


class NetworkError(TooBitException):
    """网络错误"""
    pass


class OrderError(TooBitException):
    """订单相关错误"""
    pass


# TooBit 特定错误码映射
ERROR_CODE_MAP = {
    -1000: "未知错误",
    -1001: "内部错误",
    -1002: "服务不可用",
    -1003: "超时",
    -1004: "请求被拒绝",
    -1006: "异常响应",
    -1007: "请求超时",
    -1008: "无效请求",
    -1009: "无效新订单",
    -1010: "无效取消订单",
    -1011: "无效订单",
    -1012: "无效交易对",
    -1013: "无效数量",
    -1014: "无效价格",
    -1015: "无效时间",
    -1016: "无效签名",
    -1017: "无效时间戳",
    -1018: "无效请求大小",
    -1019: "无效请求",
    -1020: "无效请求",
    -1021: "无效请求",
    -1022: "无效请求",
    -1023: "无效请求",
    -1024: "无效请求",
    -1025: "无效请求",
    -1026: "无效请求",
    -1027: "无效请求",
    -1028: "无效请求",
    -1029: "无效请求",
    -1030: "无效请求",
    -1031: "无效请求",
    -1032: "无效请求",
    -1033: "无效请求",
    -1034: "无效请求",
    -1035: "无效请求",
    -1036: "无效请求",
    -1037: "无效请求",
    -1038: "无效请求",
    -1039: "无效请求",
    -1040: "无效请求",
    -1041: "无效请求",
    -1042: "无效请求",
    -1043: "无效请求",
    -1044: "无效请求",
    -1045: "无效请求",
    -1046: "无效请求",
    -1047: "无效请求",
    -1048: "无效请求",
    -1049: "无效请求",
    -1050: "无效请求",
    -1051: "无效请求",
    -1052: "无效请求",
    -1053: "无效请求",
    -1054: "无效请求",
    -1055: "无效请求",
    -1056: "无效请求",
    -1057: "无效请求",
    -1058: "无效请求",
    -1059: "无效请求",
    -1060: "无效请求",
    -1061: "无效请求",
    -1062: "无效请求",
    -1063: "无效请求",
    -1064: "无效请求",
    -1065: "无效请求",
    -1066: "无效请求",
    -1067: "无效请求",
    -1068: "无效请求",
    -1069: "无效请求",
    -1070: "无效请求",
    -1071: "无效请求",
    -1072: "无效请求",
    -1073: "无效请求",
    -1074: "无效请求",
    -1075: "无效请求",
    -1076: "无效请求",
    -1077: "无效请求",
    -1078: "无效请求",
    -1079: "无效请求",
    -1080: "无效请求",
    -1081: "无效请求",
    -1082: "无效请求",
    -1083: "无效请求",
    -1084: "无效请求",
    -1085: "无效请求",
    -1086: "无效请求",
    -1087: "无效请求",
    -1088: "无效请求",
    -1089: "无效请求",
    -1090: "无效请求",
    -1091: "无效请求",
    -1092: "无效请求",
    -1093: "无效请求",
    -1094: "无效请求",
    -1095: "无效请求",
    -1096: "无效请求",
    -1097: "无效请求",
    -1098: "无效请求",
    -1099: "无效请求",
    -1100: "无效请求",
    -1101: "无效请求",
    -1102: "无效请求",
    -1103: "无效请求",
    -1104: "无效请求",
    -1105: "无效请求",
    -1106: "无效请求",
    -1107: "无效请求",
    -1108: "无效请求",
    -1109: "无效请求",
    -1110: "无效请求",
    -1111: "无效请求",
    -1112: "无效请求",
    -1113: "无效请求",
    -1114: "无效请求",
    -1115: "无效请求",
    -1116: "无效请求",
    -1117: "无效请求",
    -1118: "无效请求",
    -1119: "无效请求",
    -1120: "无效请求",
    -1121: "无效请求",
    -1122: "无效请求",
    -1123: "无效请求",
    -1124: "无效请求",
    -1125: "无效请求",
    -1126: "无效请求",
    -1127: "无效请求",
    -1128: "无效请求",
    -1129: "无效请求",
    -1130: "无效请求",
    -1131: "无效请求",
    -1132: "无效请求",
    -1133: "无效请求",
    -1134: "无效请求",
    -1135: "无效请求",
    -1136: "无效请求",
    -1137: "无效请求",
    -1138: "无效请求",
    -1139: "无效请求",
    -1140: "无效请求",
    -1141: "无效请求",
    -1142: "无效请求",
    -1143: "订单未找到",
    -1144: "订单已锁定",
    -1145: "订单不支持取消",
    -1146: "订单创建超时",
    -1147: "订单取消超时",
    -1193: "订单数量限制",
    -1194: "禁止市价单",
    -1195: "限价单价格太低",
    -1196: "限价单价格太高",
    -1197: "限价单买入价格太高",
    -1198: "限价单卖出价格太低",
    -1199: "订单买入数量太少",
    -1200: "订单买入数量太多",
    -1201: "限价单卖出价格太高",
    -1202: "订单卖出数量太少",
    -1203: "订单卖出数量太多",
    -1206: "订单金额太大",
    -2010: "新订单被拒绝",
    -2011: "取消订单被拒绝",
    -2013: "订单不存在",
    -2014: "API密钥格式无效",
    -2015: "API密钥被拒绝",
    -2016: "无交易窗口",
}


def get_error_message(code: int) -> str:
    """根据错误码获取错误信息"""
    return ERROR_CODE_MAP.get(code, f"未知错误码: {code}")


def raise_toobit_exception(code: int, message: str, response: Optional[Dict[str, Any]] = None):
    """根据错误码抛出相应的异常"""
    error_message = f"{get_error_message(code)}: {message}"
    
    # 打印详细的错误信息
    print(f"错误详情: {error_message}")
    if response:
        print(f"错误响应数据: {response}")
    
    if code in [-1001, -1002, -1003, -1006, -1007]:
        raise NetworkError(error_message, code, response)
    elif code in [-1016, -2014, -2015]:
        raise AuthenticationError(error_message, code, response)
    elif code in [-1004, -1008, -1009, -1010, -1011, -1012, -1013, -1014, -1015, -1017, -1018]:
        raise ValidationError(error_message, code, response)
    elif code in [-1143, -1144, -1145, -1146, -1147, -1193, -1194, -1195, -1196, -1197, -1198, -1199, -1200, -1201, -1202, -1203, -1206, -2010, -2011, -2013, -2016]:
        raise OrderError(error_message, code, response)
    elif code == -1005:  # 速率限制
        raise RateLimitError(error_message, code, response)
    else:
        raise APIError(error_message, code, response) 